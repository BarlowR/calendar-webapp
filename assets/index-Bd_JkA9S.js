var C=Object.defineProperty;var T=(c,t,e)=>t in c?C(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var r=(c,t,e)=>T(c,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();function v(c,t){return c==2?t%4==0?29:28:c==1||c==3||c==5||c==7||c==8||c==10||c==12?31:30}const z={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"};class A{constructor(t,e){this.days={},this.month=t,this.days_in_month=v(t,e);for(var a=1;a<this.days_in_month+1;a++)this.days[String(a)]={text:"",checkboxes:[]}}}class L{constructor(t){this.year=t,this.months={};for(var e=1;e<13;e++)this.months[String(e)]=new A(e,t)}}class M{constructor(){r(this,"initialize_from_jsons",t=>{const e=JSON.parse(t);return e.checkboxes&&e.year_data?(this.year_data=e.year_data,this.checkboxes=e.checkboxes,this.visuals=e.visuals,!0):(console.log("Bad data"),!1)});r(this,"initialize_new",(t,e={})=>{this.add_new_year(t),this.checkboxes=e,this.visuals={month_text_color:"#166709",line_color:"#000000",finished_day_color:"#67490929",background_color:"#e8dec9"}});r(this,"add_new_year",t=>{this.year_data[t]=new L(t)});r(this,"add_new_checkbox",(t,e)=>{this.checkboxes[t]=e});r(this,"remove_checkbox",t=>{delete this.checkboxes[t]});r(this,"save_to_jsons",()=>JSON.stringify(this));r(this,"save_to_browser",()=>{localStorage.calendar_data=this.save_to_jsons()});r(this,"load_from_browser",()=>{const t=localStorage.getItem("calendar_data");return t!==null?this.initialize_from_jsons(t):(console.log("Could not load from localStorage"),!1)});r(this,"get_day_text",(t,e,a)=>{const i=Number(e)>0&&Number(e)<=12,s=Number(a)>0&&Number(a)<=v(Number(e),Number(t));if(!(t in this.year_data)||!i||!s){console.log("value not in range");return}var n=this.year_data[t].months[e].days[a];return n.text});r(this,"set_day_text",(t,e,a,i)=>{const s=Number(e)>0&&Number(e)<=12,n=Number(a)>0&&Number(a)<=v(Number(e),Number(t));if(!s||!n){console.log("value not in range:"),console.log(t,e,a),console.log(s,n);return}var o=this.year_data[t].months[e].days[a];o.text=i});r(this,"get_day_checkboxes",(t,e,a,i)=>{const s=Number(e)>0&&Number(e)<=12,n=Number(a)>0&&Number(a)<=v(Number(e),Number(t));if(!s||!n){console.log("value not in range:"),console.log(t,e,a),console.log(s,n);return}var o=this.year_data[t].months[e].days[a];return o.checkboxes});r(this,"set_day_checkboxes",(t,e,a,i)=>{const s=Number(e)>0&&Number(e)<=12,n=Number(a)>0&&Number(a)<=v(Number(e),Number(t));if(!s||!n){console.log("value not in range:"),console.log(t,e,a),console.log(s,n);return}var o=this.year_data[t].months[e].days[a];o.checkboxes=i});this.year_data={},this.checkboxes={}}}const m=100,l=350,k=4,p=60;function h(c){return c*l/100}const S="Tahoma";function N(c,t,e,a,i){const s=c-e,n=t-a,o=s/i,_=n/i;return[o,_]}function R(c,t){var a=[1,4,4,0,2,5,0,3,6,1,4,6],i=t-1900,s=(a[c-1]+i+(Math.floor(i/4)+1)-2)%7;return s}class O{constructor(t,e,a){r(this,"set_viewport",()=>{this.viewport_x=0,"view_x"in localStorage&&(this.viewport_x=Number(localStorage.view_x),isNaN(this.viewport_x)&&(this.viewport_x=0)),this.viewport_y=0,"view_y"in localStorage&&(this.viewport_y=Number(localStorage.view_y),isNaN(this.viewport_y)&&(this.viewport_y=0)),this.viewport_scale=.5,"view_scale"in localStorage&&(this.viewport_scale=Number(localStorage.view_scale))});r(this,"render_page",()=>{this.scheduled_animation_frame||(this.scheduled_animation_frame=!0,requestAnimationFrame(()=>{this.render_to_display_context(),this.scheduled_animation_frame=!1}))});r(this,"render_to_display_context",()=>{this.display_canvas_context.fillStyle=this.calendar_data.visuals.background_color,this.display_canvas_context.fillRect(0,0,this.display_canvas.width,this.display_canvas.height);const t=this.staging_canvas.width*this.viewport_scale,e=this.staging_canvas.height*this.viewport_scale,a=.6;if(this.viewport_scale>this.intermediary_scale_step){this.display_canvas_context.drawImage(this.staging_canvas,0,0,s,n,Math.floor(this.viewport_x),Math.floor(this.viewport_y),t,e);return}var i=a,s=this.staging_canvas.width*i,n=this.staging_canvas.height*i;this.scaling_context.fillStyle=this.calendar_data.visuals.background_color,this.scaling_context.fillRect(0,0,this.scaling_canvas.width,this.scaling_canvas.height),this.scaling_context.drawImage(this.staging_canvas,0,0,this.staging_canvas.width,this.staging_canvas.height,0,0,s,n);for(var o=!1;!o;){const g=s,d=n;s*=a,n*=a,s<t&&(s=t,n=e,o=!0),this.scaling_context.drawImage(this.scaling_canvas,0,0,g,d,0,0,s,n)}const _=this.viewport_scale;this.last_scaling_factor=_,this.display_canvas_context.drawImage(this.scaling_canvas,0,0,s,n,Math.floor(this.viewport_x),Math.floor(this.viewport_y),t,e)});r(this,"set_interact_position",t=>{this.mouse_x=t.clientX,this.mouse_y=t.clientY});r(this,"update_scale",t=>{const[e,a]=N(this.mouse_x,this.mouse_y,this.viewport_x,this.viewport_y,this.viewport_scale);this.viewport_scale-=t.deltaY/2e3,this.viewport_scale<=.05?this.viewport_scale=.05:this.viewport_scale>=3&&(this.viewport_scale=3);const i=e*this.viewport_scale+this.viewport_x,s=a*this.viewport_scale+this.viewport_y;localStorage.view_scale=this.viewport_scale,this.update_offset(this.mouse_x-i,this.mouse_y-s),this.render_page()});r(this,"update_offset",(t,e)=>{this.viewport_x+=t,this.viewport_y+=e,this.clamp_offset(),localStorage.view_x=this.viewport_x,localStorage.view_y=this.viewport_y});r(this,"clamp_offset",()=>{const t=m-this.staging_canvas.width*this.viewport_scale,e=this.display_canvas.width-m,a=m-this.staging_canvas.height*this.viewport_scale,i=this.display_canvas.height-m;this.viewport_x<t?this.viewport_x=t:this.viewport_x>e&&(this.viewport_x=e),this.viewport_y<a?this.viewport_y=a:this.viewport_y>i&&(this.viewport_y=i)});r(this,"resize",t=>{this.display_canvas.width=window.innerWidth,this.display_canvas.height=window.innerHeight,this.update_offset(0,0),this.render_page()});r(this,"onclick",t=>{const[e,a]=N(t.clientX,t.clientY,this.viewport_x,this.viewport_y,this.viewport_scale);for(var i of Object.keys(this.click_functions))this.click_functions[i](e,a)});r(this,"register_click_function",(t,e)=>(this.click_functions[e]=t,e));r(this,"remove_click_function",t=>{delete this.click_functions[t]});r(this,"draw_day",(t,e,a,i,s,n="")=>{const o=this.staging_context;o.strokeStyle=s,o.lineWidth=k,o.beginPath(),o.rect(t,e,l,l),o.stroke(),n!=""&&(o.fillStyle=n,o.fillRect(t,e,l,l)),o.beginPath(),o.fillStyle=s,o.textBaseline="top",o.textAlign="left",o.font=String(h(16))+"px "+S,o.beginPath(),o.fillText(String(a),t+h(5),e+h(5)),i.text&&this.draw_day_text(t,e,i.text),this.draw_day_checkboxes(t,e,i.checkboxes)});r(this,"draw_day_text",(t,e,a)=>{const i=this.staging_context,s=a.split(/\r?\n|\r|\n/g);var n=e+h(95);i.textBaseline="bottom";for(var o of s.reverse()){var _=h(10);o.includes("###")?(_=h(10),o=o.substring(3)):o.includes("##")?(_=h(14),o=o.substring(2)):o.includes("#")&&(_=h(16),o=o.substring(1)),o.charAt(0)==" "&&(o=o.substring(1)),i.font=String(_)+"px "+S,i.fillText(o,t+h(5),n),n-=_}});r(this,"draw_day_checkboxes",(t,e,a)=>{const i=this.staging_context,s=h(15);var n=e+h(5);const o=t+l-h(15),_=h(10);for(const g in this.calendar_data.checkboxes)a.includes(g)&&(i.fillStyle=this.calendar_data.checkboxes[g],i.fillRect(o,n,_,_)),i.beginPath(),i.lineWidth=k/2,i.strokeRect(o,n,_,_),n+=s});r(this,"draw_month",(t,e,a,i,s,n="",o="")=>{const _=i.month;n==""&&(n=s);for(var d=R(_,a),f=0,u=1;u<i.days_in_month+1;u++){const w=t+d*l,y=e+f*l,b=u,D=new Date(a,_-1,b),j=new Date().setDate(new Date().getDate()-1);var x=String(_)+"-"+String(b);j>D.getTime()&&o!=""?this.draw_day(w,y,u,i.days[String(u)],s,o):this.draw_day(w,y,u,i.days[String(u)],s),this.register_click_function((q,E)=>{this.check_clicked(q,E,w,w+l,y,y+l,()=>{this.edit_menu(a,_,b)})},x),d+=1,d%7==0&&(d=0,f+=1)}this.staging_context.strokeStyle=s,this.staging_context.beginPath(),this.staging_context.lineWidth=k*1.2,this.staging_context.strokeRect(t,e,l*7,l*6),this.staging_context.stroke(),f!=5&&(d=0,f=5),this.staging_context.fillStyle=n,this.staging_context.textBaseline="middle",this.staging_context.textAlign="left",this.staging_context.font=String(h(40))+"px "+S,this.staging_context.fillText(z[_],t+d*l+h(50),e+f*l+h(50),l*7,l*6)});r(this,"draw_year",(t,e,a,i,s="",n="")=>{const o=a.year,_=7*l+p,g=6*l+p;for(var d=1,f=0;f<3;f++)for(var u=0;u<4;u++){const x=a.months[String(d)];this.draw_month(t+u*_,e+f*g,o,x,i,s,n),d++}});r(this,"draw",()=>{this.scheduled_redraw||(this.scheduled_redraw=!0,console.log("redrawing"),requestAnimationFrame(()=>{this.staging_context.fillStyle=this.calendar_data.visuals.background_color,this.staging_context.fillRect(0,0,this.staging_canvas.width,this.staging_canvas.height),this.draw_year(5,5,this.calendar_data.year_data[2025],this.calendar_data.visuals.line_color,this.calendar_data.visuals.month_text_color,this.calendar_data.visuals.finished_day_color),this.scheduled_redraw=!1,this.render_page()}))});r(this,"edit_menu",(t,e,a)=>{this.day_entry.open_sidebar(t,e,a)});this.day_entry=e,this.calendar_data=a,this.display_canvas=t,this.display_canvas_context=this.display_canvas.getContext("2d"),this.display_canvas.width=window.innerWidth,this.display_canvas.height=window.innerHeight,this.staging_canvas=document.createElement("canvas"),this.staging_context=this.staging_canvas.getContext("2d"),this.staging_canvas.width=l*7*4+p*3+50,this.staging_canvas.height=l*6*3+p*2+50,this.scaling_canvas=document.createElement("canvas"),this.scaling_context=this.scaling_canvas.getContext("2d"),this.scaling_canvas.width=l*7*4+p*3+50,this.scaling_canvas.height=l*6*3+p*2+50,this.viewport_x,this.viewport_y,this.viewport_scale,this.set_viewport(),this.click_functions=[],this.mouse_x=0,this.mouse_y=0,this.last_scaling_factor=-1,this.draw()}check_clicked(t,e,a,i,s,n,o){t>a&&t<i&&e>s&&e<n&&o()}}class B{constructor(t,e,a){r(this,"set_redraw",t=>{this.redraw=t});r(this,"render_date",(t,e,a)=>String(t)+"-"+String(e)+"-"+String(a));r(this,"cbx_name",t=>"checkbox-"+t);r(this,"open_sidebar",(t,e,a)=>{this.current_year=t,this.current_month=e,this.current_day=a,this.date_display.innerText=this.render_date(t,e,a),this.text_entry.value=this.calendar_data.get_day_text(t,e,a);const i=this.calendar_data.checkboxes,s=this.calendar_data.get_day_checkboxes(t,e,a);for(const n in i){const o=n,_=i[n],g=s.includes(n);this.append_checkbox(o,_,g)}this.day_entry_sidebar_div.style.display="block",this.click_capture.style.display="block"});r(this,"close_sidebar",()=>{this.current_year=-1,this.current_month=-1,this.current_day=-1,this.checkbox_list.innerHTML="",this.day_entry_sidebar_div.style.display="none"});r(this,"handle_submit",()=>{const t=this.text_entry.value,e=this.calendar_data.checkboxes;var a=[];for(const i in e)document.getElementById(this.cbx_name(i)).checked&&a.push(i);this.calendar_data.set_day_checkboxes(this.current_year,this.current_month,this.current_day,a),this.calendar_data.set_day_text(this.current_year,this.current_month,this.current_day,t),this.calendar_data.save_to_browser(),this.gdrive.upload_json_string_to_file(this.calendar_data.save_to_jsons()),this.redraw(),this.close_sidebar()});r(this,"append_checkbox",(t,e,a)=>{const i=document.createElement("div");i.className="checkbox-row";const s=document.createElement("div");s.className="checkbox-label",s.innerText=t;const n=document.createElement("input");n.type="checkbox",n.id=this.cbx_name(t),n.checked=a,n.style.accentColor=e,i.appendChild(s),i.appendChild(n),this.checkbox_list.appendChild(i)});this.day_entry_sidebar_div=t,this.date_display=this.day_entry_sidebar_div.querySelector("#text-entry-date"),this.date_form=this.day_entry_sidebar_div.querySelector("#day-form"),this.text_entry=this.day_entry_sidebar_div.querySelector("#day-text-entry"),this.checkbox_list=this.day_entry_sidebar_div.querySelector("#checkboxes"),this.gdrive=a,this.redraw,this.calendar_data=e,this.current_year=-1,this.current_month=-1,this.current_day=-1,this.click_capture=this.day_entry_sidebar_div.querySelector("#day-click-capture"),this.click_capture.addEventListener("click",i=>{i.stopPropagation(),this.close_sidebar()}),this.date_form.addEventListener("submit",i=>{i.preventDefault(),this.handle_submit()})}}class I{constructor(t){r(this,"auth_callback",t=>{if(t&&t.access_token){this.access_token=t.access_token,localStorage.access_token=t.access_token;var e=new Date;e.setSeconds(e.getSeconds()+Number(t.expires_in)),localStorage.access_token_expiration=e,this.on_auth_callback(this.access_token)}else console.error("Bad response")});r(this,"check_if_authorized",()=>{const t=localStorage.getItem("access_token"),e=localStorage.getItem("access_token_expiration");if(t&&e){if(new Date(e)>new Date)return this.access_token=t,!0;console.log("Token Expired")}return!1});r(this,"request_auth",()=>{if(this.check_if_authorized())return console.log("Already Authorized"),this.on_auth_callback&&this.on_auth_callback(this.access_token),!0;try{return this.client.requestAccessToken(),!0}catch{return console.error("Could not authenticate"),!1}});this.client_id="132466932829-s6ml9k12mtjs01qa5gs5s0u6frll6ep1.apps.googleusercontent.com",this.scope="https://www.googleapis.com/auth/drive.appdata",this.on_auth_callback=t,this.client=google.accounts.oauth2.initTokenClient({client_id:this.client_id,scope:this.scope,callback:this.auth_callback})}}class F{constructor(t){r(this,"set_redraw",t=>{this.redraw=t});r(this,"auth_callback",t=>{this.access_token=t,this.check_for_file()});r(this,"download_calendar_file",t=>{var e=new XMLHttpRequest;e.open("GET","https://www.googleapis.com/drive/v3/files/"+t+"?alt=media"),e.setRequestHeader("Authorization","Bearer "+this.access_token),e.onreadystatechange=a=>{e.readyState==4&&(e.status===200?this.calendar_data.initialize_from_jsons(e.response)&&this.redraw():console.log(e.response))},e.send(null)});r(this,"check_for_file",()=>{var t=new XMLHttpRequest;t.open("GET","https://www.googleapis.com/drive/v3/files?access_token="+this.access_token+"&spaces=appDataFolder");var e=!1;t.onload=a=>{if(t.status!=200){console.log(t.response);return}const i=JSON.parse(t.response);for(const s of i.files)s.name===this.json_file_name&&!e?(this.file_id=s.id,this.found_file(),e=!0):this.delete_file(s.id)},t.send(null)});r(this,"found_file",()=>{console.log("File Exists"),this.download_calendar_file(this.file_id)});r(this,"upload_json_string_to_file",t=>{if(!this.access_token)return console.error("no auth"),!1;this.file_id!=""&&this.delete_file(this.file_id);const e=new Blob([t],{type:"application/json"});var a={name:this.json_file_name,mimeType:"application/json",parents:["appDataFolder"]},i=new FormData;i.append("metadata",new Blob([JSON.stringify(a)],{type:"application/json"})),i.append("file",e);var s=new XMLHttpRequest;s.open("post","https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id"),s.setRequestHeader("Authorization","Bearer "+this.access_token),s.onload=()=>{this.file_id=JSON.parse(s.response).id,console.log("Created new File "+this.file_id)},s.send(i)});r(this,"delete_file",t=>{var e=new XMLHttpRequest;e.open("delete","https://www.googleapis.com/drive/v3/files/"+t+"?access_token="+this.access_token),e.onload=()=>{console.log("deleted: "+t)},e.send()});this.json_file_name="calendar.json",this.file_id="",this.calendar_data=t,this.redraw=()=>{}}}function H(){var c=new M;c.load_from_browser()||(console.log("Initializing new year"),c.initialize_new(2025,{Run:"#51a145",Lift:"#f5b32e"}));var t=new F(c);const e=document.getElementById("calendar-canvas"),a=document.getElementById("text-entry-sidebar");var i=new B(a,c,t),s=new O(e,i,c);i.set_redraw(s.draw),t.set_redraw(s.draw);var n=new I(t.auth_callback);n.request_auth()&&console.log("Auth success"),P(s,e)}function P(c,t){var e=!1,a,i;t.ontouchstart=t.onmousedown=s=>{e=!0,a=s.clientX,i=s.clientY,setTimeout(()=>{a==s.clientX&&i==s.clientY&&!e&&c.onclick(s)},200)},window.ontouchend=window.onmouseup=s=>{e=!1},window.ontouchmove=window.onmousemove=s=>{if(c.set_interact_position(s),!e)return;const n=s.clientX-a,o=s.clientY-i;c.update_offset(n,o),a=s.clientX,i=s.clientY,c.render_to_display_context()},window.onresize=s=>{c.resize(s)},window.onwheel=s=>{c.update_scale(s)}}window.addEventListener("load",H);
